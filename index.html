<!DOCTYPE html>
<html lang="th">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>The Market Unbundled: HPI vs Archetype</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <link href="https://fonts.googleapis.com/css2?family=Sarabun:wght@300;400;600;800&display=swap" rel="stylesheet">
    <style>
        body { font-family: 'Sarabun', sans-serif; background-color: #f8fafc; }
        .btn-primary { @apply bg-blue-600 text-white font-bold py-2 px-6 rounded-lg shadow hover:bg-blue-700 transition transform hover:-translate-y-1; }
        .card { @apply bg-white rounded-xl shadow-md p-6 border border-gray-100; }
        .badge { @apply text-xs font-bold px-2 py-1 rounded; }
    </style>
</head>
<body class="text-slate-800">

    <div class="max-w-6xl mx-auto p-4 min-h-screen flex flex-col">
        
        <header class="text-center mb-8 pt-8">
            <h1 class="text-4xl font-extrabold text-slate-900 mb-2">üìä The Market Unbundled</h1>
            <p class="text-slate-500 text-lg">"‡∏Ñ‡πà‡∏≤‡πÄ‡∏â‡∏•‡∏µ‡πà‡∏¢‡∏Ñ‡∏∑‡∏≠‡∏†‡∏≤‡∏û‡∏•‡∏ß‡∏á‡∏ï‡∏≤ Archetype ‡∏Ñ‡∏∑‡∏≠‡∏Ñ‡∏ß‡∏≤‡∏°‡∏à‡∏£‡∏¥‡∏á"</p>
        </header>

        <section id="step-1" class="flex-1 flex flex-col items-center justify-center">
            <div class="card w-full max-w-3xl text-center">
                <h2 class="text-2xl font-bold mb-4">Phase 1: ‡∏°‡∏∏‡∏°‡∏°‡∏≠‡∏á‡∏ô‡∏±‡∏Å‡∏•‡∏á‡∏ó‡∏∏‡∏ô‡∏ó‡∏±‡πà‡∏ß‡πÑ‡∏õ (Macro View)</h2>
                <p class="mb-6 text-gray-600">‡∏Ñ‡∏∏‡∏ì‡∏°‡∏µ‡πÄ‡∏á‡∏¥‡∏ô‡∏ó‡∏∏‡∏ô‡πÑ‡∏°‡πà‡∏à‡∏≥‡∏Å‡∏±‡∏î ‡πÅ‡∏•‡∏∞‡∏Å‡∏≥‡∏•‡∏±‡∏á‡∏î‡∏π‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏î‡∏±‡∏ä‡∏ô‡∏µ‡∏£‡∏≤‡∏Ñ‡∏≤ (HPI) ‡∏Ç‡∏≠‡∏á‡∏¢‡πà‡∏≤‡∏ô <span class="text-blue-600 font-bold">‡∏´‡πâ‡∏ß‡∏¢‡∏Ç‡∏ß‡∏≤‡∏á (New CBD)</span> ‡πÄ‡∏ó‡∏µ‡∏¢‡∏ö‡∏Å‡∏±‡∏ö‡∏ï‡∏•‡∏≤‡∏î‡∏£‡∏ß‡∏°</p>
                
                <div class="relative h-64 w-full mb-6">
                    <canvas id="macroChart"></canvas>
                </div>

                <div class="bg-blue-50 p-4 rounded-lg border-l-4 border-blue-500 text-left mb-6">
                    <p class="font-bold text-blue-800">üßê ‡∏ö‡∏ó‡∏ß‡∏¥‡πÄ‡∏Ñ‡∏£‡∏≤‡∏∞‡∏´‡πå‡∏à‡∏≤‡∏Å‡∏Å‡∏£‡∏≤‡∏ü:</p>
                    <p class="text-sm text-blue-700">"‡∏î‡∏π‡∏™‡∏¥! ‡∏Å‡∏£‡∏≤‡∏ü‡∏™‡∏µ‡∏ô‡πâ‡∏≥‡πÄ‡∏á‡∏¥‡∏ô (‡∏´‡πâ‡∏ß‡∏¢‡∏Ç‡∏ß‡∏≤‡∏á) ‡πÄ‡∏ï‡∏¥‡∏ö‡πÇ‡∏ï‡∏ä‡∏ô‡∏∞‡∏ï‡∏•‡∏≤‡∏î (‡πÄ‡∏™‡πâ‡∏ô‡∏õ‡∏£‡∏∞) ‡∏ï‡∏•‡∏≠‡∏î 5 ‡∏õ‡∏µ‡∏ó‡∏µ‡πà‡∏ú‡πà‡∏≤‡∏ô‡∏°‡∏≤ ‡∏ô‡∏µ‡πà‡∏Ñ‡∏∑‡∏≠‡∏ó‡∏≥‡πÄ‡∏•‡∏ó‡∏≠‡∏á‡∏ó‡∏µ‡πà‡∏ã‡∏∑‡πâ‡∏≠‡∏≠‡∏∞‡πÑ‡∏£‡∏Å‡πá‡∏Å‡∏≥‡πÑ‡∏£‡πÉ‡∏ä‡πà‡πÑ‡∏´‡∏°?"</p>
                </div>

                <button onclick="goToStep2()" class="btn-primary text-xl">
                    ‡∏•‡∏≠‡∏á‡∏ã‡∏∑‡πâ‡∏≠ "‡∏ó‡∏∏‡∏Å‡∏õ‡∏£‡∏∞‡πÄ‡∏†‡∏ó (Archetype)" ‡πÉ‡∏ô‡∏¢‡πà‡∏≤‡∏ô‡∏ô‡∏µ‡πâ‡∏î‡∏π
                </button>
            </div>
        </section>

        <section id="step-2" class="hidden flex-1">
            <div class="grid grid-cols-1 lg:grid-cols-3 gap-6 mb-6">
                <div class="card border-t-4 border-red-500 opacity-50" id="card-type1">
                    <div class="flex justify-between items-start mb-2">
                        <h3 class="font-bold text-lg">Type 1: Entry Level</h3>
                        <span class="badge bg-red-100 text-red-600">Mass Market</span>
                    </div>
                    <p class="text-sm text-gray-500 mb-2">‡∏Ñ‡∏≠‡∏ô‡πÇ‡∏î‡∏´‡πâ‡∏≠‡∏á‡πÄ‡∏•‡πá‡∏Å ‡πÉ‡∏ô‡∏ã‡∏≠‡∏¢ ‡πÄ‡∏ô‡πâ‡∏ô‡∏Ñ‡∏ô‡∏ó‡∏≥‡∏á‡∏≤‡∏ô‡∏á‡∏ö‡∏ô‡πâ‡∏≠‡∏¢</p>
                    <div class="text-3xl font-bold text-red-600" id="val-type1">0%</div>
                    <p class="text-xs text-gray-400 mt-1">Status: <span id="status-type1">Normal</span></p>
                </div>

                <div class="card border-t-4 border-yellow-500 opacity-50" id="card-type2">
                    <div class="flex justify-between items-start mb-2">
                        <h3 class="font-bold text-lg">Type 2: Real Demand</h3>
                        <span class="badge bg-yellow-100 text-yellow-600">Standard</span>
                    </div>
                    <p class="text-sm text-gray-500 mb-2">‡∏Ñ‡∏≠‡∏ô‡πÇ‡∏î‡∏°‡∏≤‡∏ï‡∏£‡∏ê‡∏≤‡∏ô ‡πÉ‡∏Å‡∏•‡πâ‡∏£‡∏ñ‡πÑ‡∏ü‡∏ü‡πâ‡∏≤</p>
                    <div class="text-3xl font-bold text-yellow-600" id="val-type2">0%</div>
                    <p class="text-xs text-gray-400 mt-1">Status: <span id="status-type2">Normal</span></p>
                </div>

                <div class="card border-t-4 border-green-500 opacity-50" id="card-type3">
                    <div class="flex justify-between items-start mb-2">
                        <h3 class="font-bold text-lg">Type 3: Prime Luxury</h3>
                        <span class="badge bg-green-100 text-green-600">Rare Item</span>
                    </div>
                    <p class="text-sm text-gray-500 mb-2">‡∏´‡πâ‡∏≠‡∏á‡πÉ‡∏´‡∏ç‡πà ‡∏ß‡∏¥‡∏ß‡∏™‡∏ß‡∏¢ ‡∏ï‡∏¥‡∏î‡∏ñ‡∏ô‡∏ô‡πÉ‡∏´‡∏ç‡πà/MRT</p>
                    <div class="text-3xl font-bold text-green-600" id="val-type3">0%</div>
                    <p class="text-xs text-gray-400 mt-1">Status: <span id="status-type3">Normal</span></p>
                </div>
            </div>

            <div class="card mb-6 relative">
                <div class="absolute top-4 right-4 z-10 flex space-x-2">
                    <button onclick="toggleAverage()" id="btn-toggle-avg" class="bg-gray-200 hover:bg-gray-300 text-gray-700 px-3 py-1 rounded text-sm font-bold">
                        üëÅÔ∏è ‡∏ã‡πà‡∏≠‡∏ô/‡πÅ‡∏™‡∏î‡∏á ‡πÄ‡∏™‡πâ‡∏ô‡∏Ñ‡πà‡∏≤‡πÄ‡∏â‡∏•‡∏µ‡πà‡∏¢
                    </button>
                </div>
                <h2 class="text-xl font-bold mb-4">Phase 2: ‡∏Ñ‡∏ß‡∏≤‡∏°‡∏à‡∏£‡∏¥‡∏á‡∏ó‡∏µ‡πà‡∏ã‡πà‡∏≠‡∏ô‡∏≠‡∏¢‡∏π‡πà (The Unbundling)</h2>
                <div class="h-80 w-full">
                    <canvas id="mainChart"></canvas>
                </div>
            </div>

            <div class="flex justify-center space-x-4 items-center">
                <button id="btn-start" onclick="startSimulation()" class="btn-primary w-48 text-lg">
                    ‚ñ∂Ô∏è Run Simulation
                </button>
                <div id="year-display" class="text-3xl font-bold text-slate-300">2019</div>
            </div>

            <div id="analysis-box" class="hidden mt-8 bg-slate-900 text-white p-6 rounded-xl shadow-2xl animate-fade-in-up">
                <div class="flex items-start space-x-4">
                    <div class="text-5xl">üí°</div>
                    <div>
                        <h3 class="text-2xl font-bold text-yellow-400 mb-2">‡∏ö‡∏ó‡∏™‡∏£‡∏∏‡∏õ: ‡∏ó‡∏≥‡πÑ‡∏° "‡∏Ñ‡πà‡∏≤‡πÄ‡∏â‡∏•‡∏µ‡πà‡∏¢" ‡∏ñ‡∏∂‡∏á‡πÇ‡∏Å‡∏´‡∏Å?</h3>
                        <p class="mb-4 text-gray-300">
                            ‡∏Ñ‡∏∏‡∏ì‡πÄ‡∏´‡πá‡∏ô‡πÄ‡∏™‡πâ‡∏ô‡∏õ‡∏£‡∏∞‡∏™‡∏µ‡πÄ‡∏ó‡∏≤ (Average) ‡πÑ‡∏´‡∏°? ‡∏°‡∏±‡∏ô‡∏¢‡∏±‡∏á‡∏î‡∏π‡πÄ‡∏õ‡πá‡∏ô‡∏Ç‡∏≤‡∏Ç‡∏∂‡πâ‡∏ô‡∏™‡∏ß‡∏¢‡∏á‡∏≤‡∏° ‡πÅ‡∏ï‡πà‡πÉ‡∏ô‡∏û‡∏≠‡∏£‡πå‡∏ï‡∏Ç‡∏≠‡∏á‡∏Ñ‡∏∏‡∏ì:
                        </p>
                        <ul class="space-y-2 mb-4">
                            [cite_start]<li class="flex items-center"><span class="w-3 h-3 bg-red-500 rounded-full mr-2"></span> <strong class="mr-2">Type 1 (Mass):</strong> ‡∏Ç‡∏≤‡∏î‡∏ó‡∏∏‡∏ô‡∏¢‡∏±‡∏ö‡πÄ‡∏¢‡∏¥‡∏ô (-20%) ‡πÄ‡∏û‡∏£‡∏≤‡∏∞ Oversupply ‡πÅ‡∏•‡∏∞‡∏Ñ‡∏ô‡πÄ‡∏ä‡πà‡∏≤‡πÑ‡∏°‡πà‡∏°‡∏µ‡πÄ‡∏á‡∏¥‡∏ô‡∏à‡πà‡∏≤‡∏¢ (Debt Crisis) [cite: 31, 61-63]</li>
                            [cite_start]<li class="flex items-center"><span class="w-3 h-3 bg-green-500 rounded-full mr-2"></span> <strong class="mr-2">Type 3 (Luxury):</strong> ‡∏Å‡∏≥‡πÑ‡∏£‡∏°‡∏´‡∏≤‡∏®‡∏≤‡∏• (+50%) ‡∏î‡∏∂‡∏á‡πÉ‡∏´‡πâ‡∏Ñ‡πà‡∏≤‡πÄ‡∏â‡∏•‡∏µ‡πà‡∏¢‡∏£‡∏ß‡∏°‡∏î‡∏π‡∏î‡∏µ ‡∏ó‡∏±‡πâ‡∏á‡∏ó‡∏µ‡πà‡∏à‡∏£‡∏¥‡∏á‡πÜ ‡∏°‡∏µ‡πÅ‡∏Ñ‡πà‡∏Ñ‡∏ô‡∏£‡∏ß‡∏¢‡∏Å‡∏•‡∏∏‡πà‡∏°‡πÄ‡∏î‡∏µ‡∏¢‡∏ß‡∏ó‡∏µ‡πà‡∏£‡∏≠‡∏î (K-Shaped Recovery) [cite: 60, 64-66]</li>
                        </ul>
                        <p class="font-bold text-white bg-slate-800 p-2 rounded inline-block">
                            Key Takeaway: ‡∏≠‡∏¢‡πà‡∏≤‡∏ã‡∏∑‡πâ‡∏≠ "‡∏¢‡πà‡∏≤‡∏ô" ‡πÉ‡∏´‡πâ‡∏ã‡∏∑‡πâ‡∏≠ "Archetype ‡∏ó‡∏µ‡πà‡∏ñ‡∏π‡∏Å‡∏ï‡πâ‡∏≠‡∏á‡πÉ‡∏ô‡∏¢‡πà‡∏≤‡∏ô‡∏ô‡∏±‡πâ‡∏ô"
                        </p>
                    </div>
                </div>
            </div>
        </section>

    </div>

    <script>
        // --- DATA SETUP ---
        // 2019 - 2024 Data Points
        const years = [2019, 2020, 2021, 2022, 2023, 2024];
        
        // The Trap Data (Average HPI)
        const avgHPI = [100, 102, 105, 110, 115, 120]; // Looks steady growth
        const marketAvg = [100, 101, 102, 103, 104, 105]; // Benchmark

        // The Real Data (Archetypes) based on Document
        // Type 1: High Supply, Fragile Demand (Crash in 2020, Stagnant)
        const type1Data = [100, 85, 82, 80, 81, 78]; 
        
        // Type 2: Stable, Real Demand (Slight dip, slow recovery)
        const type2Data = [100, 95, 96, 98, 102, 105];

        // Type 3: Luxury, Scarcity (Anomaly jump in 2021, high growth)
        const type3Data = [100, 105, 130, 145, 160, 175]; 

        // --- CHART CONFIG ---
        let macroChart, mainChart;

        function initMacroChart() {
            const ctx = document.getElementById('macroChart').getContext('2d');
            macroChart = new Chart(ctx, {
                type: 'line',
                data: {
                    labels: years,
                    datasets: [
                        {
                            label: 'Huai Khwang HPI (Avg)',
                            data: avgHPI,
                            borderColor: '#2563eb', // Blue
                            backgroundColor: 'rgba(37, 99, 235, 0.1)',
                            borderWidth: 4,
                            fill: true,
                            tension: 0.4
                        },
                        {
                            label: 'Bangkok Market Avg',
                            data: marketAvg,
                            borderColor: '#94a3b8', // Slate
                            borderDash: [5, 5],
                            borderWidth: 2,
                            tension: 0.4
                        }
                    ]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: { legend: { position: 'bottom' } },
                    scales: { y: { min: 70, max: 180 } }
                }
            });
        }

        function initMainChart() {
            const ctx = document.getElementById('mainChart').getContext('2d');
            mainChart = new Chart(ctx, {
                type: 'line',
                data: {
                    labels: years,
                    datasets: [
                        {
                            label: '‡∏Ñ‡πà‡∏≤‡πÄ‡∏â‡∏•‡∏µ‡πà‡∏¢ (Average) - ‡∏†‡∏≤‡∏û‡∏•‡∏ß‡∏á‡∏ï‡∏≤',
                            data: [], // Starts empty
                            borderColor: '#cbd5e1', // Light Gray
                            borderWidth: 4,
                            borderDash: [10, 5],
                            pointRadius: 0,
                            tension: 0.4,
                            order: 1
                        },
                        {
                            label: 'Type 1: Entry Level',
                            data: [],
                            borderColor: '#ef4444', // Red
                            backgroundColor: 'rgba(239, 68, 68, 0.5)',
                            borderWidth: 3,
                            tension: 0.2,
                            order: 2
                        },
                        {
                            label: 'Type 2: Real Demand',
                            data: [],
                            borderColor: '#eab308', // Yellow
                            backgroundColor: 'rgba(234, 179, 8, 0.5)',
                            borderWidth: 3,
                            tension: 0.2,
                            order: 3
                        },
                        {
                            label: 'Type 3: Luxury',
                            data: [],
                            borderColor: '#22c55e', // Green
                            backgroundColor: 'rgba(34, 197, 94, 0.5)',
                            borderWidth: 3,
                            tension: 0.2,
                            order: 4
                        }
                    ]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    animation: false, // We control animation manually
                    plugins: { 
                        legend: { position: 'bottom' },
                        tooltip: { mode: 'index', intersect: false }
                    },
                    scales: { y: { min: 70, max: 180, title: { display: true, text: 'Index Value (Base=100)' } } }
                }
            });
        }

        // --- GAME LOGIC ---

        function goToStep2() {
            document.getElementById('step-1').classList.add('hidden');
            document.getElementById('step-2').classList.remove('hidden');
            initMainChart();
        }

        let currentStep = 0;
        let isAvgVisible = true;

        function startSimulation() {
            document.getElementById('btn-start').disabled = true;
            document.getElementById('btn-start').classList.add('opacity-50', 'cursor-not-allowed');
            
            // Activate cards
            document.querySelectorAll('.card.opacity-50').forEach(el => el.classList.remove('opacity-50'));

            const interval = setInterval(() => {
                if (currentStep >= years.length) {
                    clearInterval(interval);
                    document.getElementById('analysis-box').classList.remove('hidden');
                    return;
                }

                // Update Chart Data
                mainChart.data.datasets[0].data.push(avgHPI[currentStep]);
                mainChart.data.datasets[1].data.push(type1Data[currentStep]);
                mainChart.data.datasets[2].data.push(type2Data[currentStep]);
                mainChart.data.datasets[3].data.push(type3Data[currentStep]);
                mainChart.update();

                // Update UI Numbers & Narrative
                updateCardUI(currentStep);

                currentStep++;
            }, 1200); // 1.2 seconds per year
        }

        function updateCardUI(index) {
            const year = years[index];
            document.getElementById('year-display').innerText = year;

            // Type 1 Logic
            const t1Val = type1Data[index] - 100;
            document.getElementById('val-type1').innerText = (t1Val > 0 ? "+" : "") + t1Val + "%";
            if(year === 2020) document.getElementById('status-type1').innerText = "‚ö†Ô∏è COVID Crisis: Tenants leaving";
            if(year === 2022) document.getElementById('status-type1').innerText = "‚ùå Debt Overload";
            if(t1Val < 0) document.getElementById('val-type1').classList.replace('text-gray-800', 'text-red-600');

            // Type 2 Logic
            const t2Val = type2Data[index] - 100;
            document.getElementById('val-type2').innerText = (t2Val > 0 ? "+" : "") + t2Val + "%";
            if(year === 2020) document.getElementById('status-type2').innerText = "Hold: WFH Impact";

            // Type 3 Logic
            const t3Val = type3Data[index] - 100;
            document.getElementById('val-type3').innerText = (t3Val > 0 ? "+" : "") + t3Val + "%";
            if(year === 2021) document.getElementById('status-type3').innerText = "üöÄ High Demand: Chinese Investors";
            if(year === 2023) document.getElementById('status-type3').innerText = "üî• Record High";
        }

        function toggleAverage() {
            isAvgVisible = !isAvgVisible;
            mainChart.data.datasets[0].hidden = !isAvgVisible;
            mainChart.update();
            document.getElementById('btn-toggle-avg').innerText = isAvgVisible ? "üëÅÔ∏è ‡∏ã‡πà‡∏≠‡∏ô Average" : "üëÅÔ∏è ‡πÅ‡∏™‡∏î‡∏á Average";
        }

        // Init Step 1
        initMacroChart();

    </script>
</body>
</html>
