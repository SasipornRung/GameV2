<!DOCTYPE html>
<html lang="th">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Huai Khwang: Pro Investor Simulator</title>
    
    <script src="https://cdn.tailwindcss.com"></script>
    <script crossorigin src="https://unpkg.com/react@18/umd/react.development.js"></script>
    <script crossorigin src="https://unpkg.com/react-dom@18/umd/react-dom.development.js"></script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    <script src="https://unpkg.com/lucide@latest"></script>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;600;800&family=JetBrains+Mono:wght@400;700&display=swap" rel="stylesheet">

    <style>
        body { font-family: 'Inter', sans-serif; background-color: #0f172a; color: #e2e8f0; }
        .mono { font-family: 'JetBrains Mono', monospace; }
        .glass { background: rgba(30, 41, 59, 0.7); backdrop-filter: blur(10px); border: 1px solid rgba(255,255,255,0.1); }
        .progress-bar-fill { transition: width 0.5s ease-in-out; }
        /* Custom Scrollbar */
        ::-webkit-scrollbar { width: 8px; }
        ::-webkit-scrollbar-track { background: #1e293b; }
        ::-webkit-scrollbar-thumb { background: #475569; border-radius: 4px; }
        .fade-in { animation: fadeIn 0.3s ease-in; }
        @keyframes fadeIn { from { opacity: 0; transform: translateY(10px); } to { opacity: 1; transform: translateY(0); } }
    </style>
</head>
<body>
    <div id="root"></div>

    <script type="text/babel">
        const { useState, useEffect, useMemo } = React;
        
        // --- CONFIG & DATA FROM PDF ---
        const ARCHETYPES = {
            fresh_grad: { id: 'fresh_grad', name: "Fresh Graduate", salary: 12000, risk: 4, saving: 0.15, growth: 0.08, dti: 0.5, desc: "‡πÄ‡∏á‡∏¥‡∏ô‡∏ô‡πâ‡∏≠‡∏¢‡πÅ‡∏ï‡πà‡πÉ‡∏à‡∏™‡∏π‡πâ ‡πÄ‡∏ô‡πâ‡∏ô‡πÄ‡∏ï‡∏¥‡∏ö‡πÇ‡∏ï‡πÄ‡∏£‡πá‡∏ß (High Risk High Reward)" },
            corporate: { id: 'corporate', name: "Corporate Climber", salary: 25000, risk: 3, saving: 0.30, growth: 0.12, dti: 0.4, desc: "‡∏°‡∏ô‡∏∏‡∏©‡∏¢‡πå‡πÄ‡∏á‡∏¥‡∏ô‡πÄ‡∏î‡∏∑‡∏≠‡∏ô‡∏ú‡∏π‡πâ‡∏°‡∏µ‡∏ß‡∏¥‡∏ô‡∏±‡∏¢ ‡πÄ‡∏Ñ‡∏£‡∏î‡∏¥‡∏ï‡∏î‡∏µ ‡∏Å‡∏π‡πâ‡∏ú‡πà‡∏≤‡∏ô‡∏á‡πà‡∏≤‡∏¢" },
            power_couple: { id: 'power_couple', name: "Power Couple", salary: 50000, risk: 2, saving: 0.40, growth: 0.07, dti: 0.35, desc: "‡∏£‡∏≤‡∏¢‡πÑ‡∏î‡πâ‡∏Ñ‡∏π‡πà ‡∏Å‡∏π‡πâ‡∏£‡πà‡∏ß‡∏°‡∏ú‡πà‡∏≤‡∏ô‡∏â‡∏•‡∏∏‡∏¢ ‡πÄ‡∏ô‡πâ‡∏ô‡∏Ñ‡∏ß‡∏≤‡∏°‡∏°‡∏±‡πà‡∏ô‡∏Ñ‡∏á" },
            inheritance: { id: 'inheritance', name: "Inheritance Accelerator", salary: 30000, risk: 5, saving: 0.10, growth: 0.04, dti: 0.5, startCash: 2000000, desc: "‡∏°‡∏µ‡πÄ‡∏á‡∏¥‡∏ô‡∏Å‡πâ‡∏ô‡∏ñ‡∏∏‡∏á 2 ‡∏•‡πâ‡∏≤‡∏ô! ‡∏•‡πâ‡∏°‡∏ö‡∏ô‡∏ü‡∏π‡∏Å‡πÑ‡∏î‡πâ‡∏™‡∏ö‡∏≤‡∏¢" }
        };

        const TIMELINE = {
            2000: { event: "Baseline Year", severity: 1, sentiment: 50, rate: 6.0, typeMod: {1:1, 2:1, 3:1} },
            2001: { event: "Dot-com Hangover", severity: 2, sentiment: 40, rate: 5.5, typeMod: {1:0.97, 2:0.98, 3:0.95} },
            2002: { event: "Slow Recovery", severity: 1, sentiment: 45, rate: 5.0, typeMod: {1:1.01, 2:1.01, 3:1.01} },
            2003: { event: "SARS Shock", severity: 3, sentiment: 30, rate: 4.5, typeMod: {1:0.95, 2:0.95, 3:0.90} },
            2004: { event: "MRT Launch (Huai Khwang)", severity: 5, sentiment: 80, rate: 4.0, typeMod: {1:1.08, 2:1.15, 3:1.20} }, // Boom
            2005: { event: "Golden Age Begins", severity: 5, sentiment: 90, rate: 3.5, typeMod: {1:1.12, 2:1.15, 3:1.25} },
            2006: { event: "Boom Continues", severity: 5, sentiment: 90, rate: 4.0, typeMod: {1:1.10, 2:1.12, 3:1.20} },
            2007: { event: "Peak Euphoria", severity: 5, sentiment: 95, rate: 4.5, typeMod: {1:1.05, 2:1.08, 3:1.15} },
            2008: { event: "Lehman Crisis (Crash)", severity: 5, sentiment: 10, rate: 5.0, typeMod: {1:0.82, 2:0.88, 3:0.75} }, // Bust
            2009: { event: "Stimulus Recovery", severity: 3, sentiment: 40, rate: 3.0, typeMod: {1:1.05, 2:1.08, 3:1.00} },
            2010: { event: "Rebuild Phase", severity: 2, sentiment: 50, rate: 3.2, typeMod: {1:1.07, 2:1.09, 3:1.10} },
            2014: { event: "Coup Shock", severity: 3, sentiment: 35, rate: 3.5, typeMod: {1:0.95, 2:1.00, 3:0.95} },
            2015: { event: "Chinese Boom", severity: 4, sentiment: 75, rate: 3.0, typeMod: {1:1.05, 2:1.10, 3:1.30} }, // Type 3 spikes
            2018: { event: "LTV Crackdown", severity: 3, sentiment: 40, rate: 3.5, typeMod: {1:0.97, 2:1.00, 3:1.02} },
            2020: { event: "COVID-19 Pandemic", severity: 5, sentiment: 5, rate: 2.5, typeMod: {1:0.85, 2:0.95, 3:0.65} }, // Crash
            2021: { event: "K-Shaped Recovery", severity: 3, sentiment: 60, rate: 2.0, typeMod: {1:0.95, 2:1.02, 3:1.40} }, // Anomaly
            2022: { event: "Rate Hike Shock", severity: 4, sentiment: 30, rate: 4.0, typeMod: {1:0.95, 2:0.98, 3:1.05} },
            2023: { event: "China Reopening?", severity: 2, sentiment: 50, rate: 4.5, typeMod: {1:1.00, 2:1.02, 3:1.08} },
            2024: { event: "The New Normal", severity: 1, sentiment: 55, rate: 4.5, typeMod: {1:1.02, 2:1.03, 3:1.05} },
            2025: { event: "Orange Line Future", severity: 4, sentiment: 70, rate: 4.0, typeMod: {1:1.05, 2:1.10, 3:1.15} }
        };

        const PROPERTIES = {
            1: { type: 1, name: "Type 1: Entry Level", basePrice: 1200000, rent: 6000, desc: "Low-Rise, ‡∏ã‡∏≠‡∏¢‡∏•‡∏∂‡∏Å, ‡πÄ‡∏ô‡πâ‡∏ô‡∏õ‡∏•‡πà‡∏≠‡∏¢‡πÄ‡∏ä‡πà‡∏≤ Yield ‡∏™‡∏π‡∏á ‡πÅ‡∏ï‡πà‡∏£‡∏≤‡∏Ñ‡∏≤‡πÑ‡∏°‡πà‡∏ß‡∏¥‡πà‡∏á", volatility: 'High' },
            2: { type: 2, name: "Type 2: Real Demand", basePrice: 2500000, rent: 12000, desc: "Mid-Rise, ‡πÉ‡∏Å‡∏•‡πâ MRT, ‡∏°‡∏≤‡∏ï‡∏£‡∏ê‡∏≤‡∏ô‡∏Ñ‡∏ô‡∏ó‡∏≥‡∏á‡∏≤‡∏ô, ‡∏™‡∏†‡∏≤‡∏û‡∏Ñ‡∏•‡πà‡∏≠‡∏á‡∏î‡∏µ", volatility: 'Medium' },
            3: { type: 3, name: "Type 3: Prime Luxury", basePrice: 5000000, rent: 22000, desc: "High-Rise, ‡∏ï‡∏¥‡∏î‡∏ñ‡∏ô‡∏ô‡πÉ‡∏´‡∏ç‡πà, ‡πÄ‡∏ô‡πâ‡∏ô Capital Gain, ‡πÄ‡∏™‡∏µ‡πà‡∏¢‡∏á‡∏™‡∏π‡∏á‡∏ñ‡πâ‡∏≤‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏ï‡πà‡∏≤‡∏á‡∏ä‡∏≤‡∏ï‡∏¥", volatility: 'Extreme' }
        };

        // --- COMPONENTS ---

        function ProgressBar({ label, value, max, color }) {
            const width = Math.min(100, Math.max(0, (value / max) * 100));
            return (
                <div className="mb-2">
                    <div className="flex justify-between text-xs mb-1">
                        <span className="text-gray-400">{label}</span>
                        <span className={`font-mono font-bold text-${color}-400`}>{value}/{max}</span>
                    </div>
                    <div className="h-2 bg-gray-700 rounded-full overflow-hidden">
                        <div className={`h-full bg-${color}-500 progress-bar-fill`} style={{ width: `${width}%` }}></div>
                    </div>
                </div>
            );
        }

        function StatCard({ icon, label, value, subValue, color = "blue" }) {
            return (
                <div className="glass p-4 rounded-xl flex items-center gap-4">
                    <div className={`p-3 rounded-lg bg-${color}-500/20 text-${color}-400`}>
                        {icon}
                    </div>
                    <div>
                        <p className="text-xs text-gray-400 uppercase tracking-wider">{label}</p>
                        <p className="text-xl font-bold font-mono">{value}</p>
                        {subValue && <p className="text-xs text-gray-500">{subValue}</p>}
                    </div>
                </div>
            );
        }

        function Game() {
            // --- STATE ---
            const [gameState, setGameState] = useState('SETUP'); // SETUP, PLAYING, END
            const [year, setYear] = useState(2000);
            const [player, setPlayer] = useState({});
            const [assets, setAssets] = useState([]);
            const [logs, setLogs] = useState([]);
            const [modal, setModal] = useState(null); // BUY, EVENT, REPORT

            // --- COMPUTED STATS ---
            const currentEvent = TIMELINE[year] || { event: "Quiet Year", severity: 0, sentiment: 50, rate: 4.0, typeMod: {1:1.02, 2:1.03, 3:1.04} };
            
            const totalAssetsValue = useMemo(() => assets.reduce((sum, a) => sum + a.currentValue, 0), [assets]);
            const totalDebt = useMemo(() => assets.reduce((sum, a) => sum + a.debt, 0), [assets]);
            const monthlyMortgage = useMemo(() => assets.reduce((sum, a) => sum + a.installment, 0), [assets]);
            const netWorth = player.cash + totalAssetsValue - totalDebt;
            const dsr = player.salary > 0 ? (monthlyMortgage / player.salary) : 0;
            
            // --- ACTIONS ---

            const startGame = (archKey) => {
                const arch = ARCHETYPES[archKey];
                setPlayer({
                    ...arch,
                    cash: (arch.salary * 6) + (arch.startCash || 0), // 6 months savings + bonus
                    stress: 20,
                    creditScore: 700,
                    careerXp: 0
                });
                setGameState('PLAYING');
                addLog(2000, `Started journey as ${arch.name}`);
            };

            const addLog = (y, msg, type='info') => {
                setLogs(prev => [{year: y, msg, type}, ...prev]);
            };

            const calculatePrice = (type) => {
                // Simulate market price based on accumulated growth from 2000 to current year
                let multiplier = 1;
                for(let y=2000; y<=year; y++) {
                    const evt = TIMELINE[y] || { typeMod: {1:1.02, 2:1.03, 3:1.04} };
                    multiplier *= evt.typeMod[type];
                }
                return Math.round(PROPERTIES[type].basePrice * multiplier);
            };

            const buyProperty = (typeId) => {
                const prop = PROPERTIES[typeId];
                const price = calculatePrice(typeId);
                const downPayment = price * 0.20; // 20% down
                const loan = price * 0.80;
                
                // --- FINANCIAL CHECKS [cite: 194-196] ---
                if (player.cash < downPayment) {
                    alert("‡πÄ‡∏á‡∏¥‡∏ô‡∏™‡∏î‡πÑ‡∏°‡πà‡∏û‡∏≠‡∏à‡πà‡∏≤‡∏¢‡∏î‡∏≤‡∏ß‡∏ô‡πå!");
                    return;
                }
                
                // DSR Check (Debt Service Ratio)
                // Installment calculation: Loan * Rate / 12 (Simplified Interest Only for game flow) + Principal
                const rate = currentEvent.rate / 100;
                const installment = (loan * rate / 12) + (loan / (30 * 12)); // 30 Years
                
                if ((monthlyMortgage + installment) / player.salary > player.dti) {
                    alert(`‡∏Å‡∏π‡πâ‡πÑ‡∏°‡πà‡∏ú‡πà‡∏≤‡∏ô! DSR ‡πÄ‡∏Å‡∏¥‡∏ô ${player.dti*100}% (‡∏ò‡∏ô‡∏≤‡∏Ñ‡∏≤‡∏£‡∏°‡∏≠‡∏á‡∏ß‡πà‡∏≤‡∏Ñ‡∏∏‡∏ì‡∏ú‡πà‡∏≠‡∏ô‡πÑ‡∏°‡πà‡πÑ‡∏´‡∏ß)`);
                    return;
                }

                if (player.creditScore < 600) {
                    alert("‡∏Å‡∏π‡πâ‡πÑ‡∏°‡πà‡∏ú‡πà‡∏≤‡∏ô! ‡πÄ‡∏Ñ‡∏£‡∏î‡∏¥‡∏ï‡∏™‡∏Å‡∏≠‡∏£‡πå‡∏ï‡πà‡∏≥‡πÄ‡∏Å‡∏¥‡∏ô‡πÑ‡∏õ");
                    return;
                }

                // Execution
                setPlayer(prev => ({ ...prev, cash: prev.cash - downPayment }));
                setAssets(prev => [...prev, {
                    id: Date.now(),
                    type: typeId,
                    name: prop.name,
                    purchasePrice: price,
                    currentValue: price,
                    debt: loan,
                    installment: installment,
                    isRented: true // Assume rented initially
                }]);

                addLog(year, `Bought ${prop.name} for ‡∏ø${(price/1e6).toFixed(2)}M. Loan: ‡∏ø${(loan/1e6).toFixed(2)}M`, 'success');
                setModal(null);
            };

            const nextYear = () => {
                // 1. Process Career & Income
                // Base salary growth + Bonus checks
                let growth = player.growth;
                if (currentEvent.severity >= 5 && currentEvent.sentiment < 30) growth = -0.05; // Pay cut in crisis
                
                const annualSalary = player.salary * 12;
                const bonus = (Math.random() < 0.3) ? player.salary * 2 : 0; // Random bonus
                const livingExpenses = annualSalary * 0.5; // Fixed 50% lifestyle cost

                let newCash = player.cash + annualSalary + bonus - livingExpenses;
                let newStress = player.stress;

                // 2. Process Assets (Rent, Mortgage, Price Update)
                const nextYearVal = year + 1;
                if (nextYearVal > 2025) {
                    setGameState('END');
                    return;
                }
                const nextEvent = TIMELINE[nextYearVal] || { typeMod: {1:1.02, 2:1.03, 3:1.04} };

                const updatedAssets = assets.map(asset => {
                    // Mortgage Payment
                    newCash -= (asset.installment * 12);
                    
                    // Rent Calculation (Vacancy Risk based on Economy)
                    let isRented = true;
                    if (currentEvent.sentiment < 40 && Math.random() > 0.7) isRented = false; // Crisis vacancy
                    if (asset.type === 3 && currentEvent.event.includes("COVID")) isRented = false; // Luxury empty in Covid
                    
                    if (isRented) {
                        const rent = PROPERTIES[asset.type].rent * 12; // Simplified annual rent
                        newCash += rent;
                    } else {
                        addLog(year, `Vacancy alert! ${asset.name} has no tenant.`, 'error');
                        newStress += 5;
                    }

                    // Price Update for Next Year
                    const typeMult = nextEvent.typeMod[asset.type];
                    const newValue = asset.currentValue * typeMult;

                    return { ...asset, currentValue: newValue, isRented };
                });

                // 3. Life Events Logic
                if (newStress > 80) {
                    addLog(year, "Health Crisis! Hospital bill -100k due to stress.", 'error');
                    newCash -= 100000;
                    newStress = 40; // Reset after crisis
                }

                // 4. Update State
                setPlayer(prev => ({
                    ...prev,
                    salary: Math.floor(prev.salary * (1 + growth)),
                    cash: newCash,
                    stress: Math.max(0, Math.min(100, newStress - 5)), // Relax a bit each year
                    careerXp: prev.careerXp + 1,
                    creditScore: Math.min(850, prev.creditScore + 5) // Good payment history
                }));
                setAssets(updatedAssets);
                setYear(nextYearVal);
                
                // 5. Trigger Modal if Major Event
                if (TIMELINE[nextYearVal] && TIMELINE[nextYearVal].severity >= 4) {
                    setModal('EVENT_ALERT');
                }
            };

            // --- RENDER HELPERS ---
            const formatMoney = (n) => n.toLocaleString('en-US', { maximumFractionDigits: 0 });

            if (gameState === 'SETUP') {
                return (
                    <div className="min-h-screen flex items-center justify-center p-4 bg-gradient-to-br from-slate-900 to-slate-800">
                        <div className="max-w-5xl w-full">
                            <h1 className="text-4xl font-bold text-center mb-2 text-transparent bg-clip-text bg-gradient-to-r from-blue-400 to-purple-400">HUAI KHWANG: INVESTOR ORIGINS</h1>
                            <p className="text-center text-gray-400 mb-8 font-mono">Select your starting path (2000-2025)</p>
                            
                            <div className="grid grid-cols-1 md:grid-cols-2 gap-6">
                                {Object.values(ARCHETYPES).map(arch => (
                                    <button key={arch.id} onClick={() => startGame(arch.id)} 
                                        className="glass p-6 rounded-xl hover:border-blue-500 transition text-left group relative overflow-hidden">
                                        <div className="absolute top-0 right-0 p-4 opacity-10 group-hover:opacity-20 transition">
                                            <svg width="100" height="100" fill="currentColor"><circle cx="50" cy="50" r="40"/></svg>
                                        </div>
                                        <h3 className="text-xl font-bold text-blue-300 mb-1">{arch.name}</h3>
                                        <p className="text-sm text-gray-500 mb-4 font-mono">Start Salary: ‡∏ø{arch.salary.toLocaleString()}</p>
                                        <p className="text-gray-300 text-sm mb-4">{arch.desc}</p>
                                        <div className="grid grid-cols-2 gap-2 text-xs text-gray-400">
                                            <span>Risk Tolerance: {arch.risk}/5</span>
                                            <span>Savings Rate: {arch.saving*100}%</span>
                                            <span>Start Capital: {arch.startCash ? formatMoney(arch.startCash) : '0'}</span>
                                            <span>Max DTI: {arch.dti*100}%</span>
                                        </div>
                                    </button>
                                ))}
                            </div>
                        </div>
                    </div>
                );
            }

            return (
                <div className="min-h-screen p-4 md:p-6 max-w-[1600px] mx-auto flex flex-col gap-6">
                    {/* TOP BAR: STATUS */}
                    <div className="grid grid-cols-2 md:grid-cols-4 lg:grid-cols-6 gap-4">
                        <div className="col-span-2 md:col-span-2 lg:col-span-2 glass p-4 rounded-xl flex items-center justify-between border-l-4 border-blue-500">
                            <div>
                                <span className="text-xs text-blue-400 font-bold tracking-widest uppercase mb-1 block">Timeline</span>
                                <span className="text-4xl font-bold font-mono text-white">{year}</span>
                            </div>
                            <div className="text-right max-w-[200px]">
                                <span className={`text-sm font-bold ${currentEvent.severity >= 4 ? 'text-green-400 animate-pulse' : currentEvent.severity === 5 ? 'text-red-500 animate-pulse' : 'text-gray-300'}`}>
                                    {currentEvent.event}
                                </span>
                                <div className="w-full bg-gray-700 h-1 mt-2 rounded-full">
                                    <div className="bg-blue-500 h-1 rounded-full" style={{width: `${currentEvent.sentiment}%`}}></div>
                                </div>
                            </div>
                        </div>

                        <StatCard label="Cash" value={`‡∏ø${formatMoney(player.cash)}`} color="green" icon="üí∞" />
                        <StatCard label="Net Worth" value={`‡∏ø${formatMoney(netWorth)}`} color="purple" icon="üìà" />
                        <StatCard label="M. Salary" value={`‡∏ø${formatMoney(player.salary)}`} subValue={`DSR: ${(dsr*100).toFixed(1)}%`} color="yellow" icon="üíµ" />
                        
                        <div className="glass p-4 rounded-xl">
                            <ProgressBar label="Stress" value={player.stress} max={100} color={player.stress > 70 ? 'red' : 'blue'} />
                            <ProgressBar label="Credit Score" value={player.creditScore} max={850} color={player.creditScore > 700 ? 'green' : 'yellow'} />
                        </div>
                    </div>

                    <div className="grid grid-cols-1 lg:grid-cols-12 gap-6 h-full flex-grow">
                        
                        {/* LEFT: MARKET & ACTIONS */}
                        <div className="lg:col-span-8 flex flex-col gap-6">
                            
                            {/* Market Dashboard */}
                            <div className="glass p-6 rounded-xl">
                                <div className="flex justify-between items-end mb-6">
                                    <h2 className="text-xl font-bold text-gray-200 flex items-center gap-2">
                                        üè¢ Real Estate Market <span className="text-xs bg-gray-700 px-2 py-1 rounded text-gray-400 font-mono">HUAI KHWANG DISTRICT</span>
                                    </h2>
                                    <div className="text-xs text-gray-400">Interest Rate: <span className="text-white font-bold">{currentEvent.rate}%</span></div>
                                </div>
                                
                                <div className="grid grid-cols-1 md:grid-cols-3 gap-4">
                                    {[1, 2, 3].map(type => {
                                        const prop = PROPERTIES[type];
                                        const price = calculatePrice(type);
                                        const isAffordable = player.cash >= price * 0.2;
                                        // Trend indicator
                                        const prevPrice = price / currentEvent.typeMod[type];
                                        const change = ((price - prevPrice)/prevPrice) * 100;
                                        
                                        return (
                                            <div key={type} className="bg-slate-800/50 border border-slate-700 p-4 rounded-lg hover:border-blue-500 transition relative group">
                                                <div className="absolute top-2 right-2 text-xs text-gray-500 font-mono">{prop.volatility} Vol</div>
                                                <h3 className="font-bold text-blue-300 mb-1">{prop.name}</h3>
                                                <p className="text-xs text-gray-400 mb-4 h-10">{prop.desc}</p>
                                                
                                                <div className="flex justify-between items-end mb-4">
                                                    <div>
                                                        <div className="text-xs text-gray-500">Market Price</div>
                                                        <div className="text-xl font-mono font-bold">‡∏ø{(price/1e6).toFixed(2)}M</div>
                                                    </div>
                                                    <div className={`text-xs font-bold ${change >= 0 ? 'text-green-400' : 'text-red-400'}`}>
                                                        {change > 0 ? '‚ñ≤' : '‚ñº'} {Math.abs(change).toFixed(1)}%
                                                    </div>
                                                </div>

                                                <button onClick={() => buyProperty(type)} disabled={!isAffordable}
                                                    className={`w-full py-2 rounded font-bold text-sm transition ${isAffordable ? 'bg-blue-600 hover:bg-blue-500 text-white shadow-lg shadow-blue-900/50' : 'bg-gray-700 text-gray-500 cursor-not-allowed'}`}>
                                                    {isAffordable ? 'BUY (20% Down)' : 'INSUFFICIENT CASH'}
                                                </button>
                                            </div>
                                        );
                                    })}
                                </div>
                            </div>

                            {/* Portfolio Table */}
                            <div className="glass p-6 rounded-xl flex-grow">
                                <h2 className="text-xl font-bold text-gray-200 mb-4">üìÇ Asset Portfolio</h2>
                                {assets.length === 0 ? (
                                    <div className="h-32 flex items-center justify-center text-gray-500 border-2 border-dashed border-gray-700 rounded-lg">
                                        No assets acquired yet. Start investing!
                                    </div>
                                ) : (
                                    <div className="overflow-x-auto">
                                        <table className="w-full text-sm text-left text-gray-400">
                                            <thead className="text-xs uppercase bg-slate-800/50 text-gray-300">
                                                <tr>
                                                    <th className="px-4 py-3">Property</th>
                                                    <th className="px-4 py-3">Value</th>
                                                    <th className="px-4 py-3">Debt</th>
                                                    <th className="px-4 py-3">Equity</th>
                                                    <th className="px-4 py-3">Status</th>
                                                </tr>
                                            </thead>
                                            <tbody>
                                                {assets.map(asset => {
                                                    const equity = asset.currentValue - asset.debt;
                                                    const gain = asset.currentValue - asset.purchasePrice;
                                                    return (
                                                        <tr key={asset.id} className="border-b border-gray-700 hover:bg-slate-800/30">
                                                            <td className="px-4 py-3 font-medium text-white">
                                                                {asset.name}
                                                                <div className="text-xs text-gray-500">Bought @ {(asset.purchasePrice/1e6).toFixed(2)}M</div>
                                                            </td>
                                                            <td className="px-4 py-3 font-mono text-white">
                                                                {(asset.currentValue/1e6).toFixed(2)}M
                                                                <span className={`ml-2 text-xs ${gain>=0 ? 'text-green-400':'text-red-400'}`}>
                                                                    {gain>=0?'+':''}{((gain/asset.purchasePrice)*100).toFixed(0)}%
                                                                </span>
                                                            </td>
                                                            <td className="px-4 py-3 font-mono">{(asset.debt/1e6).toFixed(2)}M</td>
                                                            <td className="px-4 py-3 font-mono text-blue-300">{(equity/1e6).toFixed(2)}M</td>
                                                            <td className="px-4 py-3">
                                                                <span className={`px-2 py-1 rounded text-xs font-bold ${asset.isRented ? 'bg-green-900 text-green-300' : 'bg-red-900 text-red-300'}`}>
                                                                    {asset.isRented ? 'RENTED' : 'VACANT'}
                                                                </span>
                                                            </td>
                                                        </tr>
                                                    )
                                                })}
                                            </tbody>
                                        </table>
                                    </div>
                                )}
                            </div>
                        </div>

                        {/* RIGHT: LOGS & CONTROLS */}
                        <div className="lg:col-span-4 flex flex-col gap-6">
                            
                            {/* Action Control */}
                            <div className="glass p-6 rounded-xl text-center">
                                <button onClick={nextYear} className="w-full bg-gradient-to-r from-green-600 to-emerald-600 hover:from-green-500 hover:to-emerald-500 text-white font-bold text-xl py-4 rounded-xl shadow-lg shadow-green-900/50 transition transform active:scale-95 flex items-center justify-center gap-2">
                                    <span>END YEAR {year}</span>
                                    <svg className="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path strokeLinecap="round" strokeLinejoin="round" strokeWidth="2" d="M13 7l5 5m0 0l-5 5m5-5H6"></path></svg>
                                </button>
                                <p className="text-xs text-gray-500 mt-3">Proceed to {year+1}. Events will trigger automatically.</p>
                            </div>

                            {/* Logs Terminal */}
                            <div className="glass p-4 rounded-xl flex-grow flex flex-col h-[500px]">
                                <h3 className="text-gray-400 text-xs font-bold uppercase tracking-wider mb-3 border-b border-gray-700 pb-2">System Logs</h3>
                                <div className="flex-grow overflow-y-auto space-y-2 font-mono text-xs pr-2">
                                    {logs.map((log, i) => (
                                        <div key={i} className={`p-2 rounded border-l-2 ${log.type === 'error' ? 'border-red-500 bg-red-900/10 text-red-300' : log.type === 'success' ? 'border-green-500 bg-green-900/10 text-green-300' : 'border-blue-500 bg-blue-900/10 text-gray-300'}`}>
                                            <span className="opacity-50">[{log.year}]</span> {log.msg}
                                        </div>
                                    ))}
                                </div>
                            </div>

                        </div>
                    </div>

                    {/* EVENT MODAL */}
                    {modal === 'EVENT_ALERT' && (
                        <div className="fixed inset-0 bg-black/80 flex items-center justify-center p-4 z-50 backdrop-blur-sm fade-in">
                            <div className="glass bg-slate-900 p-8 rounded-2xl max-w-lg w-full text-center border border-blue-500 shadow-2xl shadow-blue-500/20">
                                <div className="text-4xl mb-4">üì¢</div>
                                <h2 className="text-2xl font-bold text-white mb-2">MAJOR EVENT DETECTED</h2>
                                <p className="text-xl text-blue-300 font-bold mb-4">{TIMELINE[year].event}</p>
                                <div className="text-left bg-slate-800 p-4 rounded-lg text-sm text-gray-300 mb-6 space-y-2">
                                    <p>‚Ä¢ Market Sentiment: <span className={TIMELINE[year].sentiment < 40 ? 'text-red-400' : 'text-green-400'}>{TIMELINE[year].sentiment}/100</span></p>
                                    <p>‚Ä¢ Interest Rate: {TIMELINE[year].rate}%</p>
                                    <p>‚Ä¢ Impact: {TIMELINE[year].severity >= 4 ? "High Volatility Expected" : "Moderate Impact"}</p>
                                </div>
                                <button onClick={() => setModal(null)} className="bg-blue-600 hover:bg-blue-500 text-white px-8 py-3 rounded-lg font-bold w-full transition">
                                    ACKNOWLEDGE
                                </button>
                            </div>
                        </div>
                    )}
                </div>
            );
        }

        const root = ReactDOM.createRoot(document.getElementById('root'));
        root.render(<Game />);
    </script>
</body>
</html>
