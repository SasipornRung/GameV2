<!DOCTYPE html>
<html lang="th">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Huai Khwang Alpha: Portfolio Challenge</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script crossorigin src="https://unpkg.com/react@18/umd/react.development.js"></script>
    <script crossorigin src="https://unpkg.com/react-dom@18/umd/react-dom.development.js"></script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    <link href="https://fonts.googleapis.com/css2?family=JetBrains+Mono:wght@400;700&family=Sarabun:wght@300;400;600;800&display=swap" rel="stylesheet">
    <style>
        body { font-family: 'Sarabun', sans-serif; }
        .font-mono { font-family: 'JetBrains Mono', monospace; }
        .chart-bar { transition: height 0.5s ease; }
        .fade-in { animation: fadeIn 0.5s ease-in; }
        @keyframes fadeIn { from { opacity: 0; } to { opacity: 1; } }
        /* Scrollbar styling for financial look */
        ::-webkit-scrollbar { width: 8px; }
        ::-webkit-scrollbar-track { background: #1f2937; }
        ::-webkit-scrollbar-thumb { background: #4b5563; border-radius: 4px; }
        ::-webkit-scrollbar-thumb:hover { background: #6b7280; }
    </style>
</head>
<body class="bg-gray-900 text-white h-screen overflow-hidden">
    <div id="root"></div>

    <script type="text/babel">
        const { useState, useEffect, useRef } = React;

        // ===== GAME DATA (Based on Source Document) =====
        
        // 1. Asset Classes [cite: 1, 10, 19]
        const ASSETS = {
            TYPE_1: {
                id: 'TYPE_1',
                name: "Entry Level (Mass)",
                desc: "‡∏´‡πâ‡∏≠‡∏á‡πÄ‡∏•‡πá‡∏Å ‡πÄ‡∏Ç‡πâ‡∏≤‡∏ã‡∏≠‡∏¢‡∏•‡∏∂‡∏Å ‡πÄ‡∏ô‡πâ‡∏ô First Jobber",
                risk: "High Volatility",
                price: 1500000, // ‡∏£‡∏≤‡∏Ñ‡∏≤‡πÄ‡∏£‡∏¥‡πà‡∏°‡∏ï‡πâ‡∏ô‡∏õ‡∏µ 2008
                baseYield: 0.065, // Yield ‡∏™‡∏π‡∏á‡πÅ‡∏ï‡πà‡πÄ‡∏™‡∏µ‡πà‡∏¢‡∏á [cite: 9]
                maintenance: 0.01 // ‡∏Ñ‡πà‡∏≤‡πÄ‡∏™‡∏∑‡πà‡∏≠‡∏°‡∏™‡∏†‡∏≤‡∏û
            },
            TYPE_2: {
                id: 'TYPE_2',
                name: "Real Demand (Mid)",
                desc: "‡∏°‡∏≤‡∏ï‡∏£‡∏ê‡∏≤‡∏ô ‡πÉ‡∏Å‡∏•‡πâ‡∏£‡∏ñ‡πÑ‡∏ü‡∏ü‡πâ‡∏≤ ‡∏Ñ‡∏ô‡∏ó‡∏≥‡∏á‡∏≤‡∏ô",
                risk: "Moderate / Safe Haven",
                price: 3000000,
                baseYield: 0.045, // Yield ‡∏Å‡∏•‡∏≤‡∏á‡πÜ [cite: 18]
                maintenance: 0.005
            },
            TYPE_3: {
                id: 'TYPE_3',
                name: "Prime Luxury",
                desc: "‡∏ï‡∏¥‡∏î‡∏ñ‡∏ô‡∏ô‡πÉ‡∏´‡∏ç‡πà ‡∏´‡∏≤‡∏¢‡∏≤‡∏Å ‡πÄ‡∏ô‡πâ‡∏ô‡∏ä‡∏≤‡∏ß‡∏ï‡πà‡∏≤‡∏á‡∏ä‡∏≤‡∏ï‡∏¥",
                risk: "High Cap Gain / Low Liquidity",
                price: 6000000,
                baseYield: 0.035, // Yield ‡∏ï‡πà‡∏≥‡πÄ‡∏ô‡πâ‡∏ô‡∏Ç‡∏≤‡∏¢‡∏ï‡πà‡∏≠ [cite: 27]
                maintenance: 0.008
            }
        };

        // 2. Timeline & Market Cycles [cite: 36, 48, 53, 58]
        const TIMELINE = [
            // Chapter 1: The Golden Age (Rising Tide Lifts All Boats)
            { year: 2009, phase: "Golden Age", event: "MRT Boom ‡πÄ‡∏£‡∏¥‡πà‡∏°‡∏ï‡πâ‡∏ô! ‡∏Ñ‡∏ß‡∏≤‡∏°‡∏ï‡πâ‡∏≠‡∏á‡∏Å‡∏≤‡∏£‡∏û‡∏∏‡πà‡∏á‡∏™‡∏π‡∏á", 
              growth: { TYPE_1: 0.08, TYPE_2: 0.08, TYPE_3: 0.10 }, hpi: 100 },
            { year: 2010, phase: "Golden Age", event: "‡∏ô‡πâ‡∏≥‡∏ó‡πà‡∏ß‡∏°‡πÉ‡∏´‡∏ç‡πà‡πÑ‡∏°‡πà‡∏Å‡∏£‡∏∞‡∏ó‡∏ö‡∏Ñ‡∏≠‡∏ô‡πÇ‡∏î ‡∏Ñ‡∏ô‡πÅ‡∏´‡πà‡∏ã‡∏∑‡πâ‡∏≠", 
              growth: { TYPE_1: 0.07, TYPE_2: 0.09, TYPE_3: 0.12 }, hpi: 108 },
            { year: 2011, phase: "Golden Age", event: "‡∏ô‡∏±‡∏Å‡∏•‡∏á‡∏ó‡∏∏‡∏ô‡∏à‡∏µ‡∏ô‡∏Å‡∏•‡∏∏‡πà‡∏°‡πÅ‡∏£‡∏Å‡πÄ‡∏£‡∏¥‡πà‡∏°‡πÄ‡∏Ç‡πâ‡∏≤‡∏°‡∏≤", 
              growth: { TYPE_1: 0.10, TYPE_2: 0.10, TYPE_3: 0.15 }, hpi: 118 },
            { year: 2012, phase: "Golden Age", event: "‡∏£‡∏ñ‡∏Ñ‡∏±‡∏ô‡πÅ‡∏£‡∏Å‡∏î‡∏±‡∏ô‡∏Å‡∏≥‡∏•‡∏±‡∏á‡∏ã‡∏∑‡πâ‡∏≠ (‡πÅ‡∏ï‡πà‡πÄ‡∏£‡∏¥‡πà‡∏°‡∏°‡∏µ‡∏´‡∏ô‡∏µ‡πâ)", 
              growth: { TYPE_1: 0.06, TYPE_2: 0.08, TYPE_3: 0.12 }, hpi: 128 },
            { year: 2013, phase: "Golden Age", event: "‡∏£‡∏≤‡∏Ñ‡∏≤‡∏ó‡∏µ‡πà‡∏î‡∏¥‡∏ô‡∏£‡∏±‡∏ä‡∏î‡∏≤‡∏û‡∏∏‡πà‡∏á‡∏™‡∏π‡∏á‡∏™‡∏∏‡∏î‡πÄ‡∏õ‡πá‡∏ô‡∏õ‡∏£‡∏∞‡∏ß‡∏±‡∏ï‡∏¥‡∏Å‡∏≤‡∏£‡∏ì‡πå", 
              growth: { TYPE_1: 0.05, TYPE_2: 0.07, TYPE_3: 0.10 }, hpi: 136 },
            { year: 2014, phase: "Golden Age", event: "‡∏Å‡∏≤‡∏£‡πÄ‡∏°‡∏∑‡∏≠‡∏á‡∏ô‡∏¥‡πà‡∏á‡∏ä‡∏±‡πà‡∏ß‡∏Ñ‡∏£‡∏≤‡∏ß ‡∏ï‡∏•‡∏≤‡∏î‡πÄ‡∏î‡∏¥‡∏ô‡∏ï‡πà‡∏≠", 
              growth: { TYPE_1: 0.05, TYPE_2: 0.06, TYPE_3: 0.08 }, hpi: 142 },
            
            // Chapter 2: The Reality Check (Oversupply & Stagnation)
            { year: 2015, phase: "Reality Check", event: "Supply ‡∏•‡πâ‡∏ô‡∏ï‡∏•‡∏≤‡∏î! ‡πÄ‡∏£‡∏¥‡πà‡∏°‡πÄ‡∏´‡πá‡∏ô‡∏´‡πâ‡∏≠‡∏á‡∏ß‡πà‡∏≤‡∏á‡πÄ‡∏¢‡∏≠‡∏∞", 
              growth: { TYPE_1: 0.02, TYPE_2: 0.05, TYPE_3: 0.06 }, hpi: 148 },
            { year: 2016, phase: "Reality Check", event: "‡∏ï‡∏•‡∏≤‡∏î Mass ‡πÄ‡∏£‡∏¥‡πà‡∏°‡∏≠‡∏¥‡πà‡∏°‡∏ï‡∏±‡∏ß Type 1 ‡∏£‡∏≤‡∏Ñ‡∏≤‡πÑ‡∏°‡πà‡∏ß‡∏¥‡πà‡∏á", 
              growth: { TYPE_1: 0.00, TYPE_2: 0.04, TYPE_3: 0.05 }, hpi: 152 },
            { year: 2017, phase: "Reality Check", event: "‡∏´‡∏ô‡∏µ‡πâ‡∏Ñ‡∏£‡∏±‡∏ß‡πÄ‡∏£‡∏∑‡∏≠‡∏ô‡∏û‡∏∏‡πà‡∏á ‡πÅ‡∏ö‡∏á‡∏Ñ‡πå‡πÄ‡∏£‡∏¥‡πà‡∏°‡∏õ‡∏è‡∏¥‡πÄ‡∏™‡∏ò‡∏Å‡∏π‡πâ", 
              growth: { TYPE_1: -0.02, TYPE_2: 0.03, TYPE_3: 0.05 }, hpi: 154 },
            { year: 2018, phase: "Reality Check", event: "‡∏°‡∏≤‡∏ï‡∏£‡∏Å‡∏≤‡∏£ LTV! ‡∏´‡πâ‡∏≤‡∏°‡∏Å‡∏π‡πâ‡πÄ‡∏ï‡πá‡∏° 100% ‡∏ï‡∏•‡∏≤‡∏î‡∏ä‡πá‡∏≠‡∏Ñ", 
              growth: { TYPE_1: -0.04, TYPE_2: 0.01, TYPE_3: 0.04 }, hpi: 155 },
            { year: 2019, phase: "Reality Check", event: "‡∏™‡∏á‡∏Ñ‡∏£‡∏≤‡∏°‡∏Å‡∏≤‡∏£‡∏Ñ‡πâ‡∏≤ ‡∏à‡∏µ‡∏ô‡πÄ‡∏£‡∏¥‡πà‡∏°‡∏´‡∏≤‡∏¢", 
              growth: { TYPE_1: -0.03, TYPE_2: 0.01, TYPE_3: 0.02 }, hpi: 155 },

            // Chapter 3: The Great Divergence (K-Shaped Recovery)
            { year: 2020, phase: "Crisis", event: "COVID-19! ‡∏ï‡∏•‡∏≤‡∏î‡∏û‡∏±‡∏á Type 1 ‡πÇ‡∏î‡∏ô‡∏ó‡∏¥‡πâ‡∏á‡∏î‡∏≤‡∏ß‡∏ô‡πå", 
              growth: { TYPE_1: -0.15, TYPE_2: -0.05, TYPE_3: -0.02 }, hpi: 140 }, // 
            { year: 2021, phase: "Divergence", event: "The Anomaly: ‡∏Ç‡∏≠‡∏á‡∏´‡∏£‡∏π‡∏Ç‡∏≤‡∏î‡∏ï‡∏•‡∏≤‡∏î ‡∏£‡∏≤‡∏Ñ‡∏≤‡∏û‡∏∏‡πà‡∏á‡∏™‡∏ß‡∏ô‡∏ó‡∏≤‡∏á!", 
              growth: { TYPE_1: -0.05, TYPE_2: 0.02, TYPE_3: 0.20 }, hpi: 145 }, // 
            { year: 2022, phase: "Divergence", event: "‡∏à‡∏µ‡∏ô‡πÄ‡∏õ‡∏¥‡∏î‡∏õ‡∏£‡∏∞‡πÄ‡∏ó‡∏®‡∏ö‡∏≤‡∏á‡∏™‡πà‡∏ß‡∏ô ‡∏ó‡∏∏‡∏ô‡∏à‡∏µ‡∏ô‡∏£‡∏≠‡∏ö‡πÉ‡∏´‡∏°‡πà‡∏°‡∏≤", 
              growth: { TYPE_1: -0.02, TYPE_2: 0.03, TYPE_3: 0.08 }, hpi: 150 },
            { year: 2023, phase: "Divergence", event: "‡∏î‡∏≠‡∏Å‡πÄ‡∏ö‡∏µ‡πâ‡∏¢‡∏Ç‡∏≤‡∏Ç‡∏∂‡πâ‡∏ô Type 1 ‡∏Å‡∏£‡∏∞‡∏≠‡∏±‡∏Å‡πÄ‡∏•‡∏∑‡∏≠‡∏î", 
              growth: { TYPE_1: -0.03, TYPE_2: 0.04, TYPE_3: 0.06 }, hpi: 155 },
            { year: 2024, phase: "Conclusion", event: "Stock Picker's Market: ‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏ú‡∏¥‡∏î‡∏ä‡∏µ‡∏ß‡∏¥‡∏ï‡πÄ‡∏õ‡∏•‡∏µ‡πà‡∏¢‡∏ô", 
              growth: { TYPE_1: 0.01, TYPE_2: 0.03, TYPE_3: 0.05 }, hpi: 160 }
        ];

        function Game() {
            // --- State ---
            const [yearIndex, setYearIndex] = useState(0);
            const [cash, setCash] = useState(5000000); // Start with 5M THB
            const [portfolio, setPortfolio] = useState([]);
            const [logs, setLogs] = useState([{ year: 2008, msg: "Welcome, Fund Manager. Market starts now." }]);
            const [modal, setModal] = useState(null); // 'BUY' | 'RESULT'
            const [selectedAsset, setSelectedAsset] = useState(null);
            const [gameOver, setGameOver] = useState(false);

            const currentYearData = TIMELINE[yearIndex];
            const currentYear = currentYearData.year;

            // --- Stats Calculation ---
            const portfolioValue = portfolio.reduce((sum, p) => sum + p.currentValue, 0);
            const netWorth = cash + portfolioValue;
            const cashFlow = portfolio.reduce((sum, p) => sum + (p.currentValue * p.yield), 0);

            // --- Actions ---

            const nextYear = () => {
                // 1. Process Income (Rent)
                let yearlyIncome = 0;
                let maintenanceCost = 0;
                
                const updatedPortfolio = portfolio.map(asset => {
                    // Check Crisis Impact on Yield (Vacancy) 
                    let actualYield = asset.yield;
                    if (currentYearData.phase === "Crisis" && asset.type === 'TYPE_1') {
                        actualYield = 0; // ‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏Ñ‡∏ô‡πÄ‡∏ä‡πà‡∏≤
                    }
                    if (currentYearData.phase === "Crisis" && asset.type === 'TYPE_3') {
                        actualYield *= 0.8; // ‡∏•‡∏î‡∏Ñ‡πà‡∏≤‡πÄ‡∏ä‡πà‡∏≤‡∏ä‡πà‡∏ß‡∏¢‡∏ú‡∏π‡πâ‡πÄ‡∏ä‡πà‡∏≤
                    }

                    const income = asset.currentValue * actualYield;
                    const cost = asset.currentValue * ASSETS[asset.type].maintenance;
                    
                    yearlyIncome += income;
                    maintenanceCost += cost;

                    // 2. Process Capital Gain (Price Change)
                    const growthRate = currentYearData.growth[asset.type];
                    const newValue = asset.currentValue * (1 + growthRate);

                    return { 
                        ...asset, 
                        currentValue: newValue,
                        history: [...asset.history, newValue]
                    };
                });

                const netIncome = yearlyIncome - maintenanceCost;
                setCash(prev => prev + netIncome);
                setPortfolio(updatedPortfolio);
                
                addLog(currentYear, `Cash Flow: +${formatMoney(netIncome)} (Income: ${formatMoney(yearlyIncome)}, Maint: ${formatMoney(maintenanceCost)})`);

                // 3. Move Time
                if (yearIndex < TIMELINE.length - 1) {
                    setYearIndex(prev => prev + 1);
                } else {
                    setGameOver(true);
                }
            };

            const buyAsset = (typeKey) => {
                const assetTemplate = ASSETS[typeKey];
                // Calculate Price based on HPI roughly (simplified)
                // In game reality, we should track price index per asset type, but for simplicity:
                // We use base price * accumulated growth so far
                // (To implement perfectly, we'd need to track global price indices per type. Let's approximate)
                
                // Better approach for simulation: Calculate current market price based on year
                let marketPrice = assetTemplate.price;
                for(let i=0; i<yearIndex; i++) {
                    marketPrice *= (1 + TIMELINE[i].growth[typeKey]);
                }

                if (cash < marketPrice) {
                    alert("‡πÄ‡∏á‡∏¥‡∏ô‡∏™‡∏î‡πÑ‡∏°‡πà‡∏û‡∏≠!");
                    return;
                }

                const newAsset = {
                    id: Date.now(),
                    type: typeKey,
                    name: assetTemplate.name,
                    purchasePrice: marketPrice,
                    currentValue: marketPrice,
                    yield: assetTemplate.baseYield,
                    history: [marketPrice]
                };

                setCash(prev => prev - marketPrice);
                setPortfolio(prev => [...prev, newAsset]);
                setModal(null);
                addLog(currentYear, `‡∏ã‡∏∑‡πâ‡∏≠ ${assetTemplate.name} ‡∏£‡∏≤‡∏Ñ‡∏≤ ${formatMoney(marketPrice)}`);
            };

            const sellAsset = (assetId) => {
                const asset = portfolio.find(p => p.id === assetId);
                const salePrice = asset.currentValue; // No transaction fee for simplicity
                
                setCash(prev => prev + salePrice);
                setPortfolio(prev => prev.filter(p => p.id !== assetId));
                
                const profit = salePrice - asset.purchasePrice;
                const profitPercent = (profit / asset.purchasePrice) * 100;
                addLog(currentYear, `‡∏Ç‡∏≤‡∏¢ ${asset.name} ‡∏Å‡∏≥‡πÑ‡∏£: ${formatMoney(profit)} (${profitPercent.toFixed(1)}%)`);
            };

            const addLog = (y, msg) => {
                setLogs(prev => [{year: y, msg}, ...prev]);
            };

            const formatMoney = (num) => {
                if (Math.abs(num) >= 1000000) return (num / 1000000).toFixed(2) + "M";
                if (Math.abs(num) >= 1000) return (num / 1000).toFixed(0) + "K";
                return num.toFixed(0);
            };

            // --- Render Components ---

            if (gameOver) {
                const initialWealth = 5000000;
                const totalGain = netWorth - initialWealth;
                const roi = (totalGain / initialWealth) * 100;

                return (
                    <div className="h-full flex items-center justify-center bg-gray-900 p-4">
                        <div className="bg-gray-800 p-8 rounded-xl max-w-2xl w-full border border-gray-600 shadow-2xl text-center">
                            <h1 className="text-4xl font-bold mb-2 text-blue-400">‡∏™‡∏£‡∏∏‡∏õ‡∏ú‡∏•‡∏á‡∏≤‡∏ô‡∏õ‡∏µ 2024</h1>
                            <p className="text-gray-400 mb-8">‡∏Ñ‡∏∏‡∏ì‡πÄ‡∏õ‡πá‡∏ô Fund Manager ‡πÅ‡∏ö‡∏ö‡πÑ‡∏´‡∏ô?</p>
                            
                            <div className="grid grid-cols-2 gap-4 mb-8">
                                <div className="bg-gray-700 p-4 rounded">
                                    <p className="text-sm text-gray-400">Final Net Worth</p>
                                    <p className="text-3xl font-mono font-bold text-white">{formatMoney(netWorth)}</p>
                                </div>
                                <div className="bg-gray-700 p-4 rounded">
                                    <p className="text-sm text-gray-400">Total ROI</p>
                                    <p className={`text-3xl font-mono font-bold ${roi > 0 ? 'text-green-400' : 'text-red-400'}`}>
                                        {roi.toFixed(1)}%
                                    </p>
                                </div>
                            </div>

                            <div className="text-left bg-black/30 p-4 rounded mb-6 text-sm text-gray-300">
                                <p className="font-bold mb-2">üí° ‡∏ö‡∏ó‡∏ß‡∏¥‡πÄ‡∏Ñ‡∏£‡∏≤‡∏∞‡∏´‡πå (Auditor's Note):</p>
                                <ul className="list-disc pl-5 space-y-1">
                                    <li>‡∏ñ‡πâ‡∏≤ ROI &gt; 200%: ‡∏Ñ‡∏∏‡∏ì‡∏Ñ‡∏∑‡∏≠‡πÄ‡∏ã‡∏µ‡∏¢‡∏ô‡∏ó‡∏µ‡πà‡∏≠‡πà‡∏≤‡∏ô‡∏Ç‡∏≤‡∏î‡πÄ‡∏£‡∏∑‡πà‡∏≠‡∏á "K-Shaped Recovery" ‡πÅ‡∏•‡∏∞‡∏Å‡∏•‡πâ‡∏≤‡∏ã‡∏∑‡πâ‡∏≠‡∏Ç‡∏≠‡∏á‡πÅ‡∏û‡∏á (Type 3) ‡πÉ‡∏ô‡∏ä‡πà‡∏ß‡∏á‡∏ß‡∏¥‡∏Å‡∏§‡∏ï </li>
                                    <li>‡∏ñ‡πâ‡∏≤ ROI &lt; 50%: ‡∏Ñ‡∏∏‡∏ì‡∏≠‡∏≤‡∏à‡∏ï‡∏¥‡∏î‡∏Å‡∏±‡∏ö‡∏î‡∏±‡∏Å "Mass Market" (Type 1) ‡∏ó‡∏µ‡πà‡∏£‡∏≤‡∏Ñ‡∏≤‡πÑ‡∏°‡πà‡πÑ‡∏õ‡πÑ‡∏´‡∏ô‡πÄ‡∏•‡∏¢‡∏´‡∏•‡∏±‡∏á‡∏õ‡∏µ 2016 [cite: 63]</li>
                                    <li>‡∏´‡πâ‡∏ß‡∏¢‡∏Ç‡∏ß‡∏≤‡∏á‡πÑ‡∏°‡πà‡πÉ‡∏ä‡πà‡∏´‡∏∏‡πâ‡∏ô Growth ‡∏≠‡∏µ‡∏Å‡∏ï‡πà‡∏≠‡πÑ‡∏õ ‡πÅ‡∏ï‡πà‡πÄ‡∏õ‡πá‡∏ô‡∏ï‡∏•‡∏≤‡∏î‡∏ó‡∏µ‡πà‡∏ï‡πâ‡∏≠‡∏á "‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡πÉ‡∏´‡πâ‡∏ñ‡∏π‡∏Å‡∏ï‡∏±‡∏ß" (Stock Picker's Market) </li>
                                </ul>
                            </div>

                            <button onClick={() => window.location.reload()} className="bg-blue-600 hover:bg-blue-500 text-white font-bold py-3 px-8 rounded-full transition">
                                ‡πÄ‡∏£‡∏¥‡πà‡∏°‡∏Å‡∏£‡∏∞‡∏î‡∏≤‡∏ô‡πÉ‡∏´‡∏°‡πà
                            </button>
                        </div>
                    </div>
                );
            }

            return (
                <div className="flex flex-col h-full max-w-6xl mx-auto bg-gray-900 shadow-2xl overflow-hidden">
                    
                    {/* 1. Header / Ticker */}
                    <header className="bg-gray-800 border-b border-gray-700 p-3 flex justify-between items-center z-10">
                        <div className="flex items-center gap-4">
                            <h1 className="font-bold text-xl tracking-tighter text-blue-400">HUAI KHWANG <span className="text-white">ALPHA</span></h1>
                            <span className="bg-gray-700 px-2 py-1 rounded text-xs text-gray-300 font-mono">
                                YEAR: {currentYear}
                            </span>
                            <span className={`px-2 py-1 rounded text-xs font-bold ${
                                currentYearData.phase === 'Golden Age' ? 'bg-yellow-500/20 text-yellow-400' :
                                currentYearData.phase === 'Crisis' ? 'bg-red-500/20 text-red-400' :
                                'bg-blue-500/20 text-blue-400'
                            }`}>
                                {currentYearData.phase}
                            </span>
                        </div>
                        <div className="flex gap-6 font-mono text-sm">
                            <div className="text-right">
                                <p className="text-gray-400 text-xs">CASH</p>
                                <p className="text-white font-bold">‡∏ø{formatMoney(cash)}</p>
                            </div>
                            <div className="text-right">
                                <p className="text-gray-400 text-xs">AUM (NET WORTH)</p>
                                <p className="text-blue-300 font-bold">‡∏ø{formatMoney(netWorth)}</p>
                            </div>
                        </div>
                    </header>

                    {/* 2. Main Workspace */}
                    <div className="flex-1 flex overflow-hidden">
                        
                        {/* Left: Market Data & Chart */}
                        <div className="w-2/3 flex flex-col border-r border-gray-700">
                            
                            {/* News Ticker */}
                            <div className="bg-black p-2 border-b border-gray-700 overflow-hidden whitespace-nowrap">
                                <p className="text-green-400 font-mono text-sm animate-pulse">
                                    >>> BREAKING NEWS: {currentYearData.event}
                                </p>
                            </div>

                            {/* Chart Area */}
                            <div className="flex-1 bg-gray-900 p-6 relative">
                                <h3 className="text-gray-400 text-sm mb-4 flex items-center gap-2">
                                    <span className="w-2 h-2 bg-blue-500 rounded-full"></span>
                                    HPI Index (‡∏î‡∏±‡∏ä‡∏ô‡∏µ‡∏£‡∏≤‡∏Ñ‡∏≤)
                                </h3>
                                <div className="absolute inset-x-6 bottom-6 top-16 flex items-end gap-1">
                                    {TIMELINE.slice(0, yearIndex + 1).map((t, i) => (
                                        <div key={i} className="flex-1 flex flex-col justify-end group relative">
                                            <div 
                                                className={`w-full hover:bg-blue-400 transition-all cursor-pointer ${
                                                    t.phase === 'Golden Age' ? 'bg-green-500' :
                                                    t.phase === 'Crisis' ? 'bg-red-500' :
                                                    'bg-blue-600'
                                                }`}
                                                style={{ height: `${(t.hpi - 80) * 1.5}%` }}
                                            ></div>
                                            {/* Tooltip */}
                                            <div className="opacity-0 group-hover:opacity-100 absolute bottom-full mb-2 left-0 bg-gray-800 text-xs p-2 rounded border border-gray-600 z-10 w-32">
                                                Year: {t.year}<br/>
                                                HPI: {t.hpi}<br/>
                                                {t.phase}
                                            </div>
                                        </div>
                                    ))}
                                    {/* Ghost bars for future */}
                                    {TIMELINE.slice(yearIndex + 1).map((t, i) => (
                                        <div key={i} className="flex-1 bg-gray-800/30 h-full border-b border-gray-700"></div>
                                    ))}
                                </div>
                                
                                {/* Market Sentiment Overlay */}
                                <div className="absolute top-4 right-4 bg-gray-800/80 p-3 rounded backdrop-blur border border-gray-600 text-xs">
                                    <p className="text-gray-400 mb-1">Market Sentiment</p>
                                    <div className="space-y-1">
                                        <div className="flex justify-between gap-4">
                                            <span>Type 1 (Mass):</span>
                                            <span className={currentYearData.growth.TYPE_1 >= 0 ? 'text-green-400' : 'text-red-400'}>
                                                {(currentYearData.growth.TYPE_1 * 100).toFixed(1)}%
                                            </span>
                                        </div>
                                        <div className="flex justify-between gap-4">
                                            <span>Type 2 (Real):</span>
                                            <span className={currentYearData.growth.TYPE_2 >= 0 ? 'text-green-400' : 'text-red-400'}>
                                                {(currentYearData.growth.TYPE_2 * 100).toFixed(1)}%
                                            </span>
                                        </div>
                                        <div className="flex justify-between gap-4">
                                            <span>Type 3 (Prime):</span>
                                            <span className={currentYearData.growth.TYPE_3 >= 0 ? 'text-green-400' : 'text-red-400'}>
                                                {(currentYearData.growth.TYPE_3 * 100).toFixed(1)}%
                                            </span>
                                        </div>
                                    </div>
                                </div>
                            </div>

                            {/* Control Panel */}
                            <div className="bg-gray-800 p-4 border-t border-gray-700 flex justify-between items-center">
                                <div className="flex gap-2">
                                    <button 
                                        onClick={() => setModal('BUY')}
                                        className="bg-green-600 hover:bg-green-500 text-white font-bold py-2 px-6 rounded shadow-[0_0_10px_rgba(34,197,94,0.3)] transition"
                                    >
                                        + BUY ASSET
                                    </button>
                                </div>
                                <button 
                                    onClick={nextYear}
                                    className="bg-blue-600 hover:bg-blue-500 text-white font-bold py-3 px-8 rounded shadow-[0_0_15px_rgba(59,130,246,0.4)] animate-pulse"
                                >
                                    NEXT YEAR >>
                                </button>
                            </div>
                        </div>

                        {/* Right: Portfolio & Logs */}
                        <div className="w-1/3 flex flex-col bg-gray-850">
                            
                            {/* Portfolio List */}
                            <div className="flex-1 overflow-y-auto p-4 border-b border-gray-700">
                                <h3 className="text-gray-400 text-xs font-bold mb-3 uppercase tracking-wider">Your Portfolio ({portfolio.length})</h3>
                                {portfolio.length === 0 ? (
                                    <div className="text-center text-gray-600 mt-10 p-4 border-2 border-dashed border-gray-700 rounded">
                                        No Assets.<br/>Market is moving, start investing!
                                    </div>
                                ) : (
                                    <div className="space-y-2">
                                        {portfolio.map(asset => {
                                            const gain = ((asset.currentValue - asset.purchasePrice) / asset.purchasePrice) * 100;
                                            return (
                                                <div key={asset.id} className="bg-gray-800 p-3 rounded border-l-4 border-blue-500 flex justify-between items-center group hover:bg-gray-750 transition">
                                                    <div>
                                                        <p className="font-bold text-sm text-gray-200">{asset.name}</p>
                                                        <p className="text-xs text-gray-500">{formatMoney(asset.currentValue)}</p>
                                                    </div>
                                                    <div className="text-right">
                                                        <p className={`font-mono font-bold text-sm ${gain >= 0 ? 'text-green-400' : 'text-red-400'}`}>
                                                            {gain > 0 ? '+' : ''}{gain.toFixed(1)}%
                                                        </p>
                                                        <button 
                                                            onClick={() => sellAsset(asset.id)}
                                                            className="text-xs text-red-400 hover:text-red-300 underline opacity-0 group-hover:opacity-100 transition"
                                                        >
                                                            SELL
                                                        </button>
                                                    </div>
                                                </div>
                                            );
                                        })}
                                    </div>
                                )}
                            </div>

                            {/* Logs Terminal */}
                            <div className="h-1/3 bg-black p-3 font-mono text-xs overflow-y-auto border-t border-gray-700">
                                <h3 className="text-gray-500 mb-2">SYSTEM LOGS_</h3>
                                {logs.map((log, i) => (
                                    <div key={i} className="mb-1 text-gray-300">
                                        <span className="text-blue-500">[{log.year}]</span> {log.msg}
                                    </div>
                                ))}
                            </div>
                        </div>
                    </div>

                    {/* Buy Modal */}
                    {modal === 'BUY' && (
                        <div className="fixed inset-0 bg-black/80 flex items-center justify-center p-4 z-50 backdrop-blur-sm fade-in">
                            <div className="bg-gray-800 rounded-xl max-w-4xl w-full border border-gray-600 shadow-2xl overflow-hidden flex flex-col max-h-[90vh]">
                                <div className="p-4 border-b border-gray-700 flex justify-between items-center bg-gray-900">
                                    <h2 className="text-xl font-bold text-white">MARKET OPPORTUNITIES ({currentYear})</h2>
                                    <button onClick={() => setModal(null)} className="text-gray-400 hover:text-white">‚úï</button>
                                </div>
                                
                                <div className="p-6 grid grid-cols-1 md:grid-cols-3 gap-4 overflow-y-auto">
                                    {Object.keys(ASSETS).map(key => {
                                        const asset = ASSETS[key];
                                        // Calculate current market price
                                        let currentPrice = asset.price;
                                        for(let i=0; i<yearIndex; i++) currentPrice *= (1 + TIMELINE[i].growth[key]);
                                        
                                        const canAfford = cash >= currentPrice;

                                        return (
                                            <div key={key} className={`relative p-5 rounded-lg border transition-all ${
                                                selectedAsset === key ? 'border-blue-400 bg-blue-900/20' : 'border-gray-600 bg-gray-700/50 hover:border-gray-500'
                                            } ${!canAfford ? 'opacity-50 grayscale' : ''}`}>
                                                
                                                <div className="absolute top-2 right-2 text-xs font-bold px-2 py-1 rounded bg-black/40 text-gray-300">
                                                    {asset.risk}
                                                </div>

                                                <h3 className="font-bold text-lg mb-1">{asset.name}</h3>
                                                <p className="text-xs text-gray-400 mb-4 h-10">{asset.desc}</p>
                                                
                                                <div className="space-y-2 mb-4 text-sm">
                                                    <div className="flex justify-between">
                                                        <span className="text-gray-400">Market Price:</span>
                                                        <span className="font-mono font-bold">{formatMoney(currentPrice)}</span>
                                                    </div>
                                                    <div className="flex justify-between">
                                                        <span className="text-gray-400">Est. Yield:</span>
                                                        <span className="font-mono text-green-400">{(asset.baseYield * 100).toFixed(1)}%</span>
                                                    </div>
                                                </div>

                                                {/* Analyst Note [cite: 31, 33] */}
                                                <div className="bg-black/20 p-2 rounded text-[10px] text-gray-300 mb-4 italic">
                                                    "Analyst: {
                                                        key === 'TYPE_1' ? "‡∏£‡∏∞‡∏ß‡∏±‡∏á! ‡∏ú‡∏π‡πâ‡πÄ‡∏ä‡πà‡∏≤‡∏Å‡∏•‡∏∏‡πà‡∏°‡∏ô‡∏µ‡πâ‡πÄ‡∏õ‡∏£‡∏≤‡∏∞‡∏ö‡∏≤‡∏á‡∏ï‡πà‡∏≠‡∏ß‡∏¥‡∏Å‡∏§‡∏ï (High Risk during Crisis)" :
                                                        key === 'TYPE_2' ? "‡∏ó‡∏≤‡∏á‡∏™‡∏≤‡∏¢‡∏Å‡∏•‡∏≤‡∏á ‡∏õ‡∏•‡∏≠‡∏î‡∏†‡∏±‡∏¢ ‡∏™‡∏†‡∏≤‡∏û‡∏Ñ‡∏•‡πà‡∏≠‡∏á‡∏™‡∏π‡∏á (Inflation Hedge)" :
                                                        "‡∏Ç‡∏≠‡∏á‡∏´‡∏≤‡∏¢‡∏≤‡∏Å! ‡∏ñ‡πâ‡∏≤‡∏ñ‡∏∑‡∏≠‡∏¢‡∏≤‡∏ß‡πÑ‡∏î‡πâ‡∏°‡∏µ‡πÇ‡∏≠‡∏Å‡∏≤‡∏™‡∏ä‡∏ô‡∏∞‡∏ï‡∏•‡∏≤‡∏î‡∏™‡∏π‡∏á‡∏°‡∏≤‡∏Å (Scarcity Value)"
                                                    }"
                                                </div>

                                                <button 
                                                    onClick={() => canAfford && buyAsset(key)}
                                                    disabled={!canAfford}
                                                    className={`w-full py-2 rounded font-bold ${
                                                        canAfford ? 'bg-green-600 hover:bg-green-500 text-white' : 'bg-gray-600 text-gray-400 cursor-not-allowed'
                                                    }`}
                                                >
                                                    {canAfford ? 'BUY NOW' : 'INSUFFICIENT FUNDS'}
                                                </button>
                                            </div>
                                        );
                                    })}
                                </div>
                            </div>
                        </div>
                    )}
                </div>
            );
        }

        const root = ReactDOM.createRoot(document.getElementById('root'));
        root.render(<Game />);
    </script>
</body>
</html>
